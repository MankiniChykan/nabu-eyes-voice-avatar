"undefined"!=typeof window&&(window.__NABU_EYES_DASHBOARD_CARD_VERSION__="0.0.80")
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;const e=globalThis,t=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),s=new WeakMap;let n=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const i=this.t;if(t&&void 0===e){const t=void 0!==i&&1===i.length;t&&(e=s.get(i)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),t&&s.set(i,e))}return e}toString(){return this.cssText}};const a=(e,...t)=>{const s=1===e.length?e[0]:t.reduce((t,i,s)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new n(s,e,i)},r=t?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new n("string"==typeof e?e:e+"",void 0,i))(t)})(e):e,{is:o,defineProperty:l,getOwnPropertyDescriptor:_,getOwnPropertyNames:c,getOwnPropertySymbols:h,getPrototypeOf:d}=Object,u=globalThis,p=u.trustedTypes,m=p?p.emptyScript:"",g=u.reactiveElementPolyfillSupport,f=(e,t)=>e,v={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},b=(e,t)=>!o(e,t),w={attribute:!0,type:String,converter:v,reflect:!1,useDefault:!1,hasChanged:b};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */Symbol.metadata??=Symbol("metadata"),u.litPropertyMetadata??=new WeakMap;let y=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=w){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(e,i,t);void 0!==s&&l(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){const{get:s,set:n}=_(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:s,set(t){const a=s?.call(this);n?.call(this,t),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??w}static _$Ei(){if(this.hasOwnProperty(f("elementProperties")))return;const e=d(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(f("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(f("properties"))){const e=this.properties,t=[...c(e),...h(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);void 0!==i&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(r(e))}else void 0!==e&&t.push(r(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const i=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((i,s)=>{if(t)i.adoptedStyleSheets=s.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const t of s){const s=document.createElement("style"),n=e.litNonce;void 0!==n&&s.setAttribute("nonce",n),s.textContent=t.cssText,i.appendChild(s)}})(i,this.constructor.elementStyles),i}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,i);if(void 0!==s&&!0===i.reflect){const n=(void 0!==i.converter?.toAttribute?i.converter:v).toAttribute(t,i.type);this._$Em=e,null==n?this.removeAttribute(s):this.setAttribute(s,n),this._$Em=null}}_$AK(e,t){const i=this.constructor,s=i._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=i.getPropertyOptions(s),n="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:v;this._$Em=s;const a=n.fromAttribute(t,e.type);this[s]=a??this._$Ej?.get(s)??a,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const s=this.constructor,n=this[e];if(i??=s.getPropertyOptions(e),!((i.hasChanged??b)(n,t)||i.useDefault&&i.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:s,wrapped:n},a){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==n||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,s=this[t];!0!==e||this._$AL.has(t)||void 0===s||this.C(t,void 0,i,s)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}};y.elementStyles=[],y.shadowRootOptions={mode:"open"},y[f("elementProperties")]=new Map,y[f("finalized")]=new Map,g?.({ReactiveElement:y}),(u.reactiveElementVersions??=[]).push("2.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const $=globalThis,A=$.trustedTypes,E=A?A.createPolicy("lit-html",{createHTML:e=>e}):void 0,x="$lit$",S=`lit$${Math.random().toFixed(9).slice(2)}$`,C="?"+S,N=`<${C}>`,O=document,P=()=>O.createComment(""),T=e=>null===e||"object"!=typeof e&&"function"!=typeof e,U=Array.isArray,D="[ \t\n\f\r]",z=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,H=/-->/g,M=/>/g,R=RegExp(`>|${D}(?:([^\\s"'>=/]+)(${D}*=${D}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),k=/'/g,q=/"/g,I=/^(?:script|style|textarea|title)$/i,L=(e=>(t,...i)=>({_$litType$:e,strings:t,values:i}))(1),B=Symbol.for("lit-noChange"),j=Symbol.for("lit-nothing"),F=new WeakMap,W=O.createTreeWalker(O,129);function G(e,t){if(!U(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==E?E.createHTML(t):t}const Q=(e,t)=>{const i=e.length-1,s=[];let n,a=2===t?"<svg>":3===t?"<math>":"",r=z;for(let t=0;t<i;t++){const i=e[t];let o,l,_=-1,c=0;for(;c<i.length&&(r.lastIndex=c,l=r.exec(i),null!==l);)c=r.lastIndex,r===z?"!--"===l[1]?r=H:void 0!==l[1]?r=M:void 0!==l[2]?(I.test(l[2])&&(n=RegExp("</"+l[2],"g")),r=R):void 0!==l[3]&&(r=R):r===R?">"===l[0]?(r=n??z,_=-1):void 0===l[1]?_=-2:(_=r.lastIndex-l[2].length,o=l[1],r=void 0===l[3]?R:'"'===l[3]?q:k):r===q||r===k?r=R:r===H||r===M?r=z:(r=R,n=void 0);const h=r===R&&e[t+1].startsWith("/>")?" ":"";a+=r===z?i+N:_>=0?(s.push(o),i.slice(0,_)+x+i.slice(_)+S+h):i+S+(-2===_?t:h)}return[G(e,a+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class V{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let n=0,a=0;const r=e.length-1,o=this.parts,[l,_]=Q(e,t);if(this.el=V.createElement(l,i),W.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=W.nextNode())&&o.length<r;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(x)){const t=_[a++],i=s.getAttribute(e).split(S),r=/([.?@])?(.*)/.exec(t);o.push({type:1,index:n,name:r[2],strings:i,ctor:"."===r[1]?X:"?"===r[1]?ee:"@"===r[1]?te:Z}),s.removeAttribute(e)}else e.startsWith(S)&&(o.push({type:6,index:n}),s.removeAttribute(e));if(I.test(s.tagName)){const e=s.textContent.split(S),t=e.length-1;if(t>0){s.textContent=A?A.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],P()),W.nextNode(),o.push({type:2,index:++n});s.append(e[t],P())}}}else if(8===s.nodeType)if(s.data===C)o.push({type:2,index:n});else{let e=-1;for(;-1!==(e=s.data.indexOf(S,e+1));)o.push({type:7,index:n}),e+=S.length-1}n++}}static createElement(e,t){const i=O.createElement("template");return i.innerHTML=e,i}}function Y(e,t,i=e,s){if(t===B)return t;let n=void 0!==s?i._$Co?.[s]:i._$Cl;const a=T(t)?void 0:t._$litDirective$;return n?.constructor!==a&&(n?._$AO?.(!1),void 0===a?n=void 0:(n=new a(e),n._$AT(e,i,s)),void 0!==s?(i._$Co??=[])[s]=n:i._$Cl=n),void 0!==n&&(t=Y(e,n._$AS(e,t.values),n,s)),t}class J{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,s=(e?.creationScope??O).importNode(t,!0);W.currentNode=s;let n=W.nextNode(),a=0,r=0,o=i[0];for(;void 0!==o;){if(a===o.index){let t;2===o.type?t=new K(n,n.nextSibling,this,e):1===o.type?t=new o.ctor(n,o.name,o.strings,this,e):6===o.type&&(t=new ie(n,this,e)),this._$AV.push(t),o=i[++r]}a!==o?.index&&(n=W.nextNode(),a++)}return W.currentNode=O,s}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class K{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,s){this.type=2,this._$AH=j,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Y(this,e,t),T(e)?e===j||null==e||""===e?(this._$AH!==j&&this._$AR(),this._$AH=j):e!==this._$AH&&e!==B&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>U(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==j&&T(this._$AH)?this._$AA.nextSibling.data=e:this.T(O.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,s="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=V.createElement(G(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new J(s,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=F.get(e.strings);return void 0===t&&F.set(e.strings,t=new V(e)),t}k(e){U(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,s=0;for(const n of e)s===t.length?t.push(i=new K(this.O(P()),this.O(P()),this,this.options)):i=t[s],i._$AI(n),s++;s<t.length&&(this._$AR(i&&i._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Z{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,s,n){this.type=1,this._$AH=j,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=j}_$AI(e,t=this,i,s){const n=this.strings;let a=!1;if(void 0===n)e=Y(this,e,t,0),a=!T(e)||e!==this._$AH&&e!==B,a&&(this._$AH=e);else{const s=e;let r,o;for(e=n[0],r=0;r<n.length-1;r++)o=Y(this,s[i+r],t,r),o===B&&(o=this._$AH[r]),a||=!T(o)||o!==this._$AH[r],o===j?e=j:e!==j&&(e+=(o??"")+n[r+1]),this._$AH[r]=o}a&&!s&&this.j(e)}j(e){e===j?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class X extends Z{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===j?void 0:e}}class ee extends Z{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==j)}}class te extends Z{constructor(e,t,i,s,n){super(e,t,i,s,n),this.type=5}_$AI(e,t=this){if((e=Y(this,e,t,0)??j)===B)return;const i=this._$AH,s=e===j&&i!==j||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,n=e!==j&&(i===j||s);s&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ie{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Y(this,e)}}const se=$.litHtmlPolyfillSupport;se?.(V,K),($.litHtmlVersions??=[]).push("3.3.1");const ne=globalThis;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class ae extends y{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,i)=>{const s=i?.renderBefore??t;let n=s._$litPart$;if(void 0===n){const e=i?.renderBefore??null;s._$litPart$=n=new K(t.insertBefore(P(),e),e,void 0,i??{})}return n._$AI(e),n})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return B}}ae._$litElement$=!0,ae.finalized=!0,ne.litElementHydrateSupport?.({LitElement:ae});const re=ne.litElementPolyfillSupport;re?.({LitElement:ae}),(ne.litElementVersions??=[]).push("4.2.1");const oe="/hacsfiles/nabu-eyes-voice-avatar",le="nabu_playing_dash_blue.gif",_e="1px_equalizer_dash.gif",ce={"nabu_playing_dash_blue.gif":"Nabu Playing Blue (default)","nabu_playing_dash_light.gif":"Nabu Playing Light","nabu_playing_dash_purple.gif":"Nabu Playing Purple","nabu_playing_dash_sepia.gif":"Nabu Playing Sepia"},he={"1px_equalizer_dash.gif":"1px Equalizer","1px_equalizer_fader_dash.gif":"1px Equalizer Fader","1px_equalizer_fader_2_dash.gif":"1px Equalizer Fader 2","2px_equalizer_dash.gif":"2px Equalizer","2px_equalizer_fader_dash.gif":"2px Equalizer Fader","2px_equalizer_fader_2_dash.gif":"2px Equalizer Fader 2","2px_equalizer_bottom_dash.gif":"2px Equalizer Bottom","nabu_eq_dash_blue.gif":"Nabu EQ Blue","nabu_eq2_dash_blue.gif":"Nabu EQ2 Blue","nabu_eq3_dash_blue.gif":"Nabu EQ3 Blue","nabu_eq_dash_light.gif":"Nabu EQ Light","nabu_eq2_dash_light.gif":"Nabu EQ2 Light","nabu_eq3_dash_light.gif":"Nabu EQ3 Light","nabu_eq_dash_purple.gif":"Nabu EQ Purple","nabu_eq2_dash_purple.gif":"Nabu EQ2 Purple","nabu_eq3_dash_purple.gif":"Nabu EQ3 Purple","nabu_eq_dash_sepia.gif":"Nabu EQ Sepia","nabu_eq2_dash_sepia.gif":"Nabu EQ2 Sepia","nabu_eq3_dash_sepia.gif":"Nabu EQ3 Sepia"},de={"nabu_idle_dash_blue.gif":"Idle – Blue","nabu_idle_dash_light.gif":"Idle – Light","nabu_idle_dash_purple.gif":"Idle – Purple","nabu_idle_dash_sepia.gif":"Idle – Sepia"},ue={"nabu_listening_dash_blue.gif":"Listening – Blue","nabu_listening_dash_light.gif":"Listening – Light","nabu_listening_dash_purple.gif":"Listening – Purple","nabu_listening_dash_sepia.gif":"Listening – Sepia"},pe={"nabu_processing_dash_blue.gif":"Processing – Blue","nabu_processing_dash_light.gif":"Processing – Light","nabu_processing_dash_purple.gif":"Processing – Purple","nabu_processing_dash_sepia.gif":"Processing – Sepia"},me={"nabu_responding_dash_blue.gif":"Responding – Blue","nabu_responding_dash_light.gif":"Responding – Light","nabu_responding_dash_purple.gif":"Responding – Purple","nabu_responding_dash_sepia.gif":"Responding – Sepia"},ge={"nabu_alarm_dash_blue.gif":"Alarm – Blue","nabu_alarm_dash_light.gif":"Alarm – Light","nabu_alarm_dash_purple.gif":"Alarm – Purple","nabu_alarm_dash_sepia.gif":"Alarm – Sepia"},fe={"nabu_countdown_dash_blue.gif":"Countdown – Blue","nabu_countdown_dash_light.gif":"Countdown – Light","nabu_countdown_dash_purple.gif":"Countdown – Purple","nabu_countdown_dash_sepia.gif":"Countdown – Sepia"},ve={"nabu_mute_dash_blue.gif":"Mute – Blue","nabu_mute_dash_light.gif":"Mute – Light","nabu_mute_dash_purple.gif":"Mute – Purple","nabu_mute_dash_sepia.gif":"Mute – Sepia"},be={idle:"nabu_idle_dash_blue.gif",listening:"nabu_listening_dash_blue.gif",processing:"nabu_processing_dash_blue.gif",responding:"nabu_responding_dash_blue.gif",playing:"nabu_playing_dash_blue.gif",alarm:"nabu_alarm_dash_blue.gif",countdown:"nabu_countdown_dash_blue.gif",mute:"nabu_mute_dash_blue.gif"},we=["on","detected","unavailable"];var ye,$e;!function(e){e.language="language",e.system="system",e.comma_decimal="comma_decimal",e.decimal_comma="decimal_comma",e.space_comma="space_comma",e.none="none"}(ye||(ye={})),function(e){e.language="language",e.system="system",e.am_pm="12",e.twenty_four="24"}($e||($e={}));var Ae=function(e,t,i,s){s=s||{},i=null==i?{}:i;var n=new Event(t,{bubbles:void 0===s.bubbles||s.bubbles,cancelable:Boolean(s.cancelable),composed:void 0===s.composed||s.composed});return n.detail=i,e.dispatchEvent(n),n};const Ee="rgba(0, 21, 255, 0.5)",xe="rgba(0, 255, 255, 0.5)",Se="rgba(255, 0, 255, 0.5)",Ce="rgba(255, 210, 0, 0.5)",Ne=Object.entries(ce).map(([e,t])=>({value:e,label:t})),Oe=Object.entries(he).map(([e,t])=>({value:e,label:t})),Pe=Object.entries(de).map(([e,t])=>({value:e,label:t})),Te=Object.entries(ue).map(([e,t])=>({value:e,label:t})),Ue=Object.entries(pe).map(([e,t])=>({value:e,label:t})),De=Object.entries(me).map(([e,t])=>({value:e,label:t})),ze=Object.entries(ge).map(([e,t])=>({value:e,label:t})),He=[{name:"name",selector:{text:{}}},{name:"assist_entities",selector:{entity:{domain:"assist_satellite",multiple:!0}}},{name:"playing_variant",selector:{select:{options:Ne}}},{name:"media_player",selector:{entity:{domain:"media_player"}}},{name:"mute_media_player",selector:{entity:{domain:"media_player"}}},{name:"media_player_equalizer",selector:{select:{options:Oe}}},{name:"asset_path",selector:{text:{}}},{name:"hide_when_idle",selector:{boolean:{}}},{name:"idle_dwell_seconds",selector:{number:{min:0,max:600,mode:"box"}}},{name:"fullscreen_overlay",selector:{boolean:{}}},{name:"state_idle_variant",selector:{select:{options:Pe}}},{name:"state_listening_variant",selector:{select:{options:Te}}},{name:"state_processing_variant",selector:{select:{options:Ue}}},{name:"state_responding_variant",selector:{select:{options:De}}},{name:"state_countdown_variant",selector:{select:{options:Object.entries(fe).map(([e,t])=>({value:e,label:t}))}}},{name:"state_mute_variant",selector:{select:{options:Object.entries(ve).map(([e,t])=>({value:e,label:t}))}}},{name:"doorbell_entity",selector:{entity:{domain:["binary_sensor","input_boolean","switch","button"]}}},{name:"state_alarm_variant",selector:{select:{options:ze}}},{name:"timer_mode",selector:{select:{mode:"list",options:[{value:"all",label:"All timer entities"},{value:"custom",label:"Custom timer entities"},{value:"off",label:"Timer integration disabled"}]}}},{name:"timer_entities",selector:{entity:{domain:"timer",multiple:!0}}},{name:"timer_event_started",selector:{select:{mode:"list",options:[{value:"on",label:"ON (Countdown)"},{value:"off",label:"OFF (Idle)"}]}}},{name:"timer_event_restarted",selector:{select:{mode:"list",options:[{value:"on",label:"ON (Countdown)"},{value:"off",label:"OFF (Idle)"}]}}},{name:"timer_event_paused",selector:{select:{mode:"list",options:[{value:"on",label:"ON (Countdown)"},{value:"off",label:"OFF (Idle)"}]}}},{name:"timer_event_cancelled",selector:{select:{mode:"list",options:[{value:"on",label:"ON (Countdown)"},{value:"off",label:"OFF (Idle)"}]}}},{name:"timer_event_finished",selector:{select:{mode:"list",options:[{value:"on",label:"ON (Countdown)"},{value:"off",label:"OFF (Idle)"}]}}},{name:"countdown_events",selector:{text:{multiline:!0}}},{name:"countdown_clear_events",selector:{text:{multiline:!0}}},{name:"alarm_events",selector:{text:{multiline:!0}}},{name:"alarm_clear_events",selector:{text:{multiline:!0}}},{name:"alarm_active_states",selector:{text:{multiline:!0}}},{name:"glow_radius",selector:{number:{min:0,max:200,mode:"box"}}},{name:"avatar_padding_vertical",selector:{number:{min:0,max:200,mode:"box"}}}];class Me extends ae{constructor(){super(...arguments),this._bootstrapped=!1,this._resetGlowColours=()=>{if(!this._config)return;const e={...this._config,glow_color_blue:Ee,glow_color_light:xe,glow_color_purple:Se,glow_color_sepia:Ce};this._config=e,Ae(this,"config-changed",{config:e})},this._computeLabel=e=>{switch(e.name){case"name":return"Name";case"assist_entities":return"Assist satellite entities";case"playing_variant":return"Assist playing animation";case"media_player":return"Media player for equalizer";case"mute_media_player":return"Media player for mute state";case"media_player_equalizer":return"Media player equalizer";case"asset_path":return"Asset path";case"hide_when_idle":return"Hide when idle";case"idle_dwell_seconds":return"Idle dwell time (seconds)";case"fullscreen_overlay":return"Overlay on top (centered)";case"state_idle_variant":return"Idle state variant";case"state_listening_variant":return"Listening state variant";case"state_processing_variant":return"Processing state variant";case"state_responding_variant":return"Responding state variant";case"state_countdown_variant":return"Countdown state variant";case"state_mute_variant":return"Mute state variant";case"doorbell_entity":return"Doorbell entity (triggers Alarm/Doorbell variant)";case"state_alarm_variant":return"Alarm/Doorbell state variant";case"timer_mode":return"Timer integration mode";case"timer_entities":return"Custom timer entities";case"timer_event_started":return"timer.started";case"timer_event_restarted":return"timer.restarted";case"timer_event_paused":return"timer.paused";case"timer_event_cancelled":return"timer.cancelled";case"timer_event_finished":return"timer.finished";case"countdown_events":return"Countdown events";case"countdown_clear_events":return"Countdown clear events";case"alarm_events":return"Alarm events";case"alarm_clear_events":return"Alarm clear events";case"alarm_active_states":return"Alarm active states";case"glow_radius":return"Glow radius (px)";case"avatar_padding_vertical":return"Vertical padding (px)";default:return e.name}},this._computeHelper=e=>{switch(e.name){case"asset_path":return"Folder containing GIF assets (defaults to HACS path)";case"doorbell_entity":return"Binary_sensor / input_boolean / switch / button used as doorbell; when it enters an alarm-active state, the Alarm/Doorbell animation is shown";case"timer_mode":return"Choose whether any timer.* event or only specific timer entities will drive the Nabu countdown";case"timer_entities":return"Used when Timer mode is set to Custom";case"timer_event_started":case"timer_event_restarted":case"timer_event_paused":case"timer_event_cancelled":case"timer_event_finished":return"ON = show Countdown variant, OFF = return to Idle";case"countdown_events":case"countdown_clear_events":case"alarm_events":case"alarm_clear_events":return"One event type per line or comma separated";case"alarm_active_states":return"One state per line or comma separated";case"idle_dwell_seconds":return"How long to keep idle visible before hiding when 'Hide when idle' is enabled";default:return}}}setConfig(e){this._config={...e,assist_entities:[...e.assist_entities??[]],playing_variant:e.playing_variant??le,countdown_events:[...e.countdown_events??[]],countdown_clear_events:[...e.countdown_clear_events??[]],alarm_events:[...e.alarm_events??[]],alarm_clear_events:[...e.alarm_clear_events??[]],alarm_entities:[...e.alarm_entities??[]],alarm_active_states:[...e.alarm_active_states??we],hide_when_idle:e.hide_when_idle??!1,idle_dwell_seconds:e.idle_dwell_seconds??30,glow_radius:e.glow_radius??40,avatar_padding_vertical:e.avatar_padding_vertical??0,glow_color_blue:e.glow_color_blue??Ee,glow_color_light:e.glow_color_light??xe,glow_color_purple:e.glow_color_purple??Se,glow_color_sepia:e.glow_color_sepia??Ce,fullscreen_overlay:e.fullscreen_overlay??!1,asset_path:e.asset_path??oe,media_player_equalizer:e.media_player_equalizer??_e,state_idle_variant:e.state_idle_variant??be.idle,state_listening_variant:e.state_listening_variant??be.listening,state_processing_variant:e.state_processing_variant??be.processing,state_responding_variant:e.state_responding_variant??be.responding,state_alarm_variant:e.state_alarm_variant??be.alarm,state_countdown_variant:e.state_countdown_variant??be.countdown,state_mute_variant:e.state_mute_variant??be.mute,timer_mode:e.timer_mode??"all",timer_entities:[...e.timer_entities??[]],timer_event_started:e.timer_event_started??"on",timer_event_restarted:e.timer_event_restarted??"on",timer_event_paused:e.timer_event_paused??"off",timer_event_cancelled:e.timer_event_cancelled??"off",timer_event_finished:e.timer_event_finished??"off"}}render(){if(!this.hass||!this._config)return L``;if(!this._bootstrapped){this._bootstrapped=!0;const e={};if(!this._config.assist_entities?.length){const t=Object.keys(this.hass.states).filter(e=>e.startsWith("assist_satellite."));t.length&&(e.assist_entities=t)}const t=this._config.media_player??Object.keys(this.hass.states).find(e=>e.startsWith("media_player."));if(!this._config.media_player&&t&&(e.media_player=t),!this._config.mute_media_player&&t&&(e.mute_media_player=t),!this._config.timer_entities?.length){const t=Object.keys(this.hass.states).filter(e=>e.startsWith("timer."));t.length&&(e.timer_entities=t)}if(Object.keys(e).length){const t={...this._config,...e};this._config=t,Ae(this,"config-changed",{config:t})}}const e=this._config,t=this._rgbaToHexAlpha(e.glow_color_blue??Ee,Ee),i=this._rgbaToHexAlpha(e.glow_color_light??xe,xe),s=this._rgbaToHexAlpha(e.glow_color_purple??Se,Se),n=this._rgbaToHexAlpha(e.glow_color_sepia??Ce,Ce);return L`
      <div class="form">
        <ha-form
          .hass=${this.hass}
          .data=${e}
          .schema=${He}
          .computeLabel=${this._computeLabel}
          .computeHelper=${this._computeHelper}
          @value-changed=${this._valueChanged}
        ></ha-form>

        <!-- Legacy RGBA colour pickers with alpha channel -->
        <h3 class="section-heading">Variant Glow Colours (RGBA)</h3>

        ${this._glowRow("Blue Glow","glow_color_blue",t.hex,t.alpha,Ee)}
        ${this._glowRow("Light Glow","glow_color_light",i.hex,i.alpha,xe)}
        ${this._glowRow("Purple Glow","glow_color_purple",s.hex,s.alpha,Se)}
        ${this._glowRow("Sepia Glow","glow_color_sepia",n.hex,n.alpha,Ce)}

        <div class="glow-reset-row">
          <span class="glow-reset-heading">Reset Glow Colours</span>
          <mwc-button class="glow-reset-button" raised @click=${this._resetGlowColours}>
            Reset glow colours
          </mwc-button>
        </div>
      </div>
    `}_valueChanged(e){if(!e.detail?.value)return;const t=e.detail.value,i=e=>{const i=t[e];Array.isArray(i)||"string"==typeof i&&(t[e]=i.split(/[\n,]/).map(e=>e.trim()).filter(Boolean))};i("countdown_events"),i("countdown_clear_events"),i("alarm_events"),i("alarm_clear_events"),i("alarm_active_states"),i("assist_entities"),i("timer_entities"),i("alarm_entities"),this._config=t,Ae(this,"config-changed",{config:t})}_glowRow(e,t,i,s,n){return L`
      <div class="color-row">
        <div class="color-label">${e}</div>
        <input
          type="color"
          class="color-input"
          .value=${i}
          @input=${e=>{const i=e.currentTarget,s=this._config&&this._config[t]||n,a=this._rgbaToHexAlpha(s,n),r=this._rgbaFromHexAlpha(i.value,a.alpha);this._update(t,r)}}
        />
        <ha-textfield
          class="alpha-input"
          label="α"
          type="number"
          min="0"
          max="1"
          step="0.05"
          .value=${String(s)}
          @input=${e=>{const i=e.currentTarget,s=Number(i.value);if(Number.isNaN(s))return;const a=Math.min(1,Math.max(0,s)),r=this._config&&this._config[t]||n,o=this._rgbaToHexAlpha(r,n),l=this._rgbaFromHexAlpha(o.hex,a);this._update(t,l)}}
        ></ha-textfield>
      </div>
    `}_rgbaToHexAlpha(e,t){const i=(e||t).trim(),s=i.match(/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([0-9.]+))?\s*\)$/i);if(s){const e=Number(s[1]),t=Number(s[2]),i=Number(s[3]),n=void 0!==s[4]?Number(s[4]):1,a="#"+[e,t,i].map(e=>{const t=Math.min(255,Math.max(0,Math.round(e))).toString(16);return 1===t.length?`0${t}`:t}).join("");return{hex:a,alpha:Math.min(1,Math.max(0,isNaN(n)?1:n))}}if(i.startsWith("#")){let e=i;if(4===e.length){const t=e[1],i=e[2],s=e[3];e=`#${t}${t}${i}${i}${s}${s}`}if(7===e.length)return{hex:e,alpha:1}}return this._rgbaToHexAlpha(t,t)}_rgbaFromHexAlpha(e,t){let i=e.trim();if(i.startsWith("#")||(i=`#${i}`),4===i.length){const e=i[1],t=i[2],s=i[3];i=`#${e}${e}${t}${t}${s}${s}`}if(7!==i.length)return Ee;return`rgba(${parseInt(i.slice(1,3),16)}, ${parseInt(i.slice(3,5),16)}, ${parseInt(i.slice(5,7),16)}, ${Math.min(1,Math.max(0,t))})`}_update(e,t){if(!this._config)return;const i={...this._config,[e]:t};this._config=i,Ae(this,"config-changed",{config:i})}static get styles(){return a`
      .form {
        display: block;
      }

      ha-form {
        --ha-form-label-width: 180px;
      }

      .section-heading {
        margin-top: 16px;
        font-size: 14px;
        font-weight: 500;
        opacity: 0.8;
      }

      .color-row {
        display: grid;
        grid-template-columns: 2fr auto 80px;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
      }

      .color-label {
        font-size: 13px;
      }

      .color-input {
        width: 40px;
        height: 24px;
        padding: 0;
        border: none;
        background: transparent;
      }

      .alpha-input {
        --mdc-text-field-outlined-hover-border-color: transparent;
      }

      .glow-reset-row {
        margin-top: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .glow-reset-heading {
        font-size: 13px;
        opacity: 0.8;
      }

      .glow-reset-button {
        --mdc-theme-primary: #f44336;
        --mdc-theme-on-primary: #ffffff;
      }
    `}}Me.properties={hass:{attribute:!1},_config:{state:!0}},customElements.get("nabu-eyes-dashboard-card-editor")||customElements.define("nabu-eyes-dashboard-card-editor",Me);const Re=be,ke=["responding","playing","processing","listening","idle"];class qe extends ae{constructor(){super(...arguments),this._countdownActive=!1,this._alarmActive=!1,this._idleDwellUntil=null,this._eventUnsubscribes=[]}static async getConfigElement(){return document.createElement("nabu-eyes-dashboard-card-editor")}static getStubConfig(){return{type:"custom:nabu-eyes-dashboard-card",name:"Nabu Eyes",assist_entities:[],asset_path:oe}}setConfig(e){if(!e)throw new Error("Invalid configuration.");const t={hide_when_idle:!1,idle_dwell_seconds:30,playing_variant:le,media_player_equalizer:_e,countdown_events:[],countdown_clear_events:[],alarm_events:[],alarm_clear_events:[],alarm_active_states:we,glow_radius:40,glow_color_blue:"rgba(0, 21, 255, 0.5)",glow_color_light:"rgba(0, 255, 255, 0.5)",glow_color_purple:"rgba(255, 0, 255, 0.5)",glow_color_sepia:"rgba(255, 210, 0, 0.5)",avatar_padding_vertical:0,fullscreen_overlay:!1,timer_mode:"all",timer_event_started:"on",timer_event_restarted:"on",timer_event_paused:"off",timer_event_cancelled:"off",timer_event_finished:"off",...e,assist_entities:Array.isArray(e.assist_entities)?[...e.assist_entities??[]]:[]};t.assist_entities=this._normalizeStringArray(t.assist_entities),t.countdown_events=this._normalizeStringArray(t.countdown_events),t.countdown_clear_events=this._normalizeStringArray(t.countdown_clear_events),t.alarm_events=this._normalizeStringArray(t.alarm_events),t.alarm_clear_events=this._normalizeStringArray(t.alarm_clear_events),t.alarm_entities=this._normalizeStringArray(t.alarm_entities),t.alarm_active_states=this._normalizeStringArray(t.alarm_active_states?.length?t.alarm_active_states:[...we]),t.timer_entities=this._normalizeStringArray(t.timer_entities??[]);const i=t.asset_path?.trim();t.asset_path=i&&i.length>0?i:oe,t.playing_variant&&t.playing_variant in ce||(t.playing_variant=le),t.media_player_equalizer&&!(t.media_player_equalizer in he)&&(t.media_player_equalizer=_e),this._config=t,this._subscribeToEvents()}_normalizeStringArray(e){return Array.from(new Set((e??[]).map(e=>e?.trim()).filter(e=>!!e?.length)))}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeFromEvents(),this._resetIdleDwell(),this._countdownTicker&&(window.clearInterval(this._countdownTicker),this._countdownTicker=void 0)}connectedCallback(){super.connectedCallback(),this._countdownTicker||(this._countdownTicker=window.setInterval(()=>{this._config&&"off"!==(this._config.timer_mode??"all")&&this.requestUpdate()},1e3))}updated(e){e.has("hass")&&this._subscribeToEvents()}async _subscribeToEvents(){if(this._unsubscribeFromEvents(),!this.hass?.connection||!this._config)return;const e=new Set([...this._config.countdown_events??[],...this._config.countdown_clear_events??[],...this._config.alarm_events??[],...this._config.alarm_clear_events??[]]);if(this._config.timer_mode&&"off"!==this._config.timer_mode&&(e.add("timer.started"),e.add("timer.restarted"),e.add("timer.paused"),e.add("timer.cancelled"),e.add("timer.finished")),0!==e.size)for(const t of e)if(t)try{const e=await this.hass.connection.subscribeEvents(e=>{this._handleEvent(t,e.event_type,e.data)},t);this._eventUnsubscribes.push(e)}catch(e){this._logError(`nabu-eyes-dashboard-card: failed to subscribe to event ${t}`,e)}}_unsubscribeFromEvents(){for(;this._eventUnsubscribes.length;){const e=this._eventUnsubscribes.pop();e&&e()}}_isRelevantTimerEvent(e,t){if(!this._config||!this.hass)return!1;if(!e.startsWith("timer."))return!1;const i=this._config.timer_mode??"all";if("off"===i)return!1;const s=t.entity_id??"";if(!s.startsWith("timer."))return!1;if("all"===i)return!0;const n=this._config.timer_entities??[];return!n.length||n.includes(s)}_handleEvent(e,t,i){if(!this._config||t!==e)return;if(t.startsWith("timer.")&&this._isRelevantTimerEvent(t,i)){const e=this._config,i=e=>{e&&(this._countdownActive="on"===e)};switch(t){case"timer.started":i(e.timer_event_started??"on");break;case"timer.restarted":i(e.timer_event_restarted??"on");break;case"timer.paused":i(e.timer_event_paused??"off");break;case"timer.cancelled":i(e.timer_event_cancelled??"off");break;case"timer.finished":i(e.timer_event_finished??"off")}return void this.requestUpdate()}const{countdown_events:s=[],countdown_clear_events:n=[],alarm_events:a=[],alarm_clear_events:r=[]}=this._config;if(s.includes(t)&&(this._countdownActive=!0),n.includes(t)&&(this._countdownActive=!1),a.includes(t)&&(this._alarmActive=!0),r.includes(t)&&(this._alarmActive=!1),i&&Object.prototype.hasOwnProperty.call(i,"active")&&"boolean"==typeof i.active){const e=!!i.active;(s.includes(t)||n.includes(t))&&(this._countdownActive=e),(a.includes(t)||r.includes(t))&&(this._alarmActive=e)}}getCardSize(){return 3}_resolveStateFilename(e){if(!this._config)return Re[e];switch(e){case"idle":return this._config.state_idle_variant||Re.idle;case"listening":return this._config.state_listening_variant||Re.listening;case"processing":return this._config.state_processing_variant||Re.processing;case"responding":return this._config.state_responding_variant||Re.responding;case"playing":return this._config.playing_variant||Re.playing;case"alarm":return this._config.state_alarm_variant||Re.alarm;case"countdown":return this._config.state_countdown_variant||Re.countdown;case"mute":return this._config.state_mute_variant||Re.mute;default:return Re[e]}}_inferGlowClass(e){const t=e.toLowerCase();return t.includes("_dash_light")?"glow-light":t.includes("_dash_purple")?"glow-purple":t.includes("_dash_sepia")?"glow-sepia":"glow-blue"}render(){if(!this._config)return L``;this._updateCountdownFromTimers();const e=this._determineAsset();if(!e)return L``;const{src:t,glowClass:i}=e,s=this._config.glow_radius??40,n=this._config.avatar_padding_vertical??0,a=this._config.fullscreen_overlay??!1,{glow_color_blue:r="rgba(0, 21, 255, 0.5)",glow_color_light:o="rgba(0, 255, 255, 0.5)",glow_color_purple:l="rgba(255, 0, 255, 0.5)",glow_color_sepia:_="rgba(255, 210, 0, 0.5)"}=this._config,c=[`--nabu-eyes-glow-radius: ${s}px`,`--nabu-eyes-glow-color-blue: ${r}`,`--nabu-eyes-glow-color-light: ${o}`,`--nabu-eyes-glow-color-purple: ${l}`,`--nabu-eyes-glow-color-sepia: ${_}`,`--nabu-eyes-padding-vertical: ${n}px`].join("; "),h=a?"avatar-container overlay":"avatar-container",d=this._countdownActive&&"off"!==(this._config.timer_mode??"all")?this._computeTimerCountdown():null;return L`
      <div class="${h}" style=${c}>
        <img class="avatar ${i}" src="${t}" alt="Nabu Eyes state" />
        ${d?L`<div class="countdown-overlay">${d}</div>`:null}
      </div>
    `}_determineAsset(){if(!this._config)return;const e=this._config.asset_path&&this._config.asset_path.trim().length>0?this._config.asset_path:oe,t=t=>{const i=this._resolveStateFilename(t);return{src:this._composeAssetPath(e,i),glowClass:this._inferGlowClass(i)}},i=this._computeAssistState(),s=Date.now(),n=this._config.idle_dwell_seconds??30,a=this._lastAssistState;if(this._lastAssistState=i,i&&"idle"!==i)this._resetIdleDwell();else if("idle"===i&&this._config.hide_when_idle&&n>0)if(a&&"idle"!==a&&null===this._idleDwellUntil){const e=s+1e3*n;this._idleDwellUntil=e,this._scheduleIdleDwellTimeout(1e3*n)}else null!==this._idleDwellUntil&&s>=this._idleDwellUntil&&(this._idleDwellUntil=null);else i||this._resetIdleDwell();const r="idle"===i&&this._config.hide_when_idle&&n>0&&null!==this._idleDwellUntil&&s<this._idleDwellUntil;if(this._alarmActive||this._isAlarmEntityActive())return t("alarm");if(this._countdownActive)return t("countdown");if("playing"===i)return t("playing");if(i&&"idle"!==i)return t(i);const o=this._determineMediaPlayerAsset(e);if(o)return o;const l=this._determineMuteAsset(e);if(l)return l;if("idle"===i){if(this._config.hide_when_idle&&!r)return;return t("idle")}return this._config.hide_when_idle?void 0:t("idle")}_scheduleIdleDwellTimeout(e){this._idleDwellTimeout&&(window.clearTimeout(this._idleDwellTimeout),this._idleDwellTimeout=void 0),e<=0||(this._idleDwellTimeout=window.setTimeout(()=>{this._idleDwellTimeout=void 0,this.requestUpdate()},e))}_determineMediaPlayerAsset(e){if(!this._config?.media_player||!this.hass)return;const t=this.hass.states[this._config.media_player];if(t&&"playing"===t.state){const t=this._config.media_player_equalizer??_e,i=he[t]?t:_e;return{src:this._composeAssetPath(e,i),glowClass:this._inferGlowClass(i)}}}_determineMuteAsset(e){const t=this._config?.mute_media_player??this._config?.media_player;if(!t||!this.hass)return;const i=this.hass.states[t];if(!i)return;if(!!!i.attributes?.is_volume_muted)return;const s=this._resolveStateFilename("mute");return{src:this._composeAssetPath(e,s),glowClass:this._inferGlowClass(s)}}_isAlarmEntityActive(){if(!this.hass||!this._config)return!1;const e=this._config.alarm_active_states??we,t=[...this._config.alarm_entities??[],...this._config.doorbell_entity?[this._config.doorbell_entity]:[]];return!!t.length&&t.some(t=>{const i=this.hass.states[t];return!!i&&e.includes(i.state)})}_composeAssetPath(e,t){return e.endsWith("/")?`${e}${t}`:`${e}/${t}`}_computeAssistState(){if(!this.hass)return;const e=this._config?.assist_entities??[],t=e.length>0?e:Object.keys(this.hass.states).filter(e=>e.startsWith("assist_satellite."));if(0===t.length)return;const i=t.map(e=>this.hass.states[e]?.state).filter(e=>"string"==typeof e);for(const e of ke)if(i.includes(e))return e}_updateCountdownFromTimers(){if(!this.hass||!this._config)return;const e=this._config.timer_mode??"all";if("off"===e)return;const t="custom"===e&&(this._config.timer_entities?.length??0)>0?this._config.timer_entities:Object.keys(this.hass.states).filter(e=>e.startsWith("timer."));if(!t.length)return;const i=t.map(e=>this.hass.states[e]).filter(e=>!!e);if(!i.length)return;const s=i.some(e=>"active"===e.state);if(s)return void(this._countdownActive=!0);const n=i.some(e=>"idle"===e.state||"paused"===e.state);n&&(this._countdownActive=!1)}_computeTimerCountdown(){if(!this.hass||!this._config)return null;const e=this._config.timer_mode??"all";if("off"===e)return null;const t="custom"===e&&(this._config.timer_entities?.length??0)>0?this._config.timer_entities:Object.keys(this.hass.states).filter(e=>e.startsWith("timer."));if(!t.length)return null;const i=t.map(e=>this.hass.states[e]).find(e=>e&&"active"===e.state),s=i??null;if(!s)return null;const n=s.attributes?.finishes_at;let a=null;if(n){const e=new Date(n).getTime();if(!Number.isNaN(e)){const t=e-Date.now();a=Math.round(t/1e3)}}if(null===a){const e=s.attributes?.remaining;if(!e)return null;a=this._parseDurationToSeconds(e)}if(a<=0)return"00:00:00";const r=Math.floor(a/3600),o=Math.floor(a%3600/60),l=a%60,_=e=>e<10?`0${e}`:String(e);return`${_(r)}:${_(o)}:${_(l)}`}_parseDurationToSeconds(e){const t=e.split(":").map(e=>parseInt(e,10));if(t.some(e=>Number.isNaN(e)))return 0;let i=0,s=0,n=0;return 3===t.length?[i,s,n]=t:2===t.length?[s,n]=t:1===t.length&&([n]=t),3600*i+60*s+n}_resetIdleDwell(){this._idleDwellUntil=null,this._idleDwellTimeout&&(window.clearTimeout(this._idleDwellTimeout),this._idleDwellTimeout=void 0)}_logError(e,t){console.error("nabu-eyes-dashboard-card:",e,t??"")}static get styles(){return a`
      :host {
        display: block;
        /* default radius + border colour */
        --nabu-eyes-glow-radius: 40px;
        --nabu-eyes-border-color: #000;
      }

      .avatar-container {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--nabu-eyes-padding-vertical, 0px) 0;
        box-sizing: border-box;
      }

      .avatar-container.overlay {
        position: fixed;
        inset: 0;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        pointer-events: none; /* let clicks pass through to dashboard */
      }

      .avatar {
        display: block;
        max-width: 100%;
        height: auto;
      }

      .countdown-overlay {
        position: absolute;
        right: 12px;
        bottom: 8px;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-family: monospace;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
      }

      /* One tight black halo around non-transparent pixels + single colour glow per palette */

      .glow-blue {
        filter: drop-shadow(0 0 12px var(--nabu-eyes-border-color))
          drop-shadow(
            0 0 var(--nabu-eyes-glow-radius) var(--nabu-eyes-glow-color-blue, rgba(0, 21, 255, 0.5))
          );
      }

      .glow-light {
        filter: drop-shadow(0 0 12px var(--nabu-eyes-border-color))
          drop-shadow(
            0 0 var(--nabu-eyes-glow-radius)
              var(--nabu-eyes-glow-color-light, rgba(0, 255, 255, 0.5))
          );
      }

      .glow-purple {
        filter: drop-shadow(0 0 12px var(--nabu-eyes-border-color))
          drop-shadow(
            0 0 var(--nabu-eyes-glow-radius)
              var(--nabu-eyes-glow-color-purple, rgba(255, 0, 255, 0.5))
          );
      }

      .glow-sepia {
        filter: drop-shadow(0 0 12px var(--nabu-eyes-border-color))
          drop-shadow(
            0 0 var(--nabu-eyes-glow-radius)
              var(--nabu-eyes-glow-color-sepia, rgba(255, 208, 0, 0.5))
          );
      }
    `}}qe.properties={hass:{attribute:!1},_config:{state:!0},_countdownActive:{state:!0},_alarmActive:{state:!0}};const Ie="nabu-eyes-dashboard-card",Le="undefined"!=typeof window&&window.__NABU_EYES_DASHBOARD_CARD_VERSION__?window.__NABU_EYES_DASHBOARD_CARD_VERSION__:"dev";if(customElements.get(Ie)||(customElements.define(Ie,qe),"undefined"!=typeof window&&console.info("%cNABU-EYES-DASHBOARD-CARD%c "+Le+" %cIS INSTALLED","color:#03a9f4;font-weight:bold;","color:#e0e0e0;font-weight:bold;","color:#4caf50;font-weight:bold;")),"undefined"!=typeof window){window.customCards=window.customCards??[];window.customCards.some(e=>e.type===Ie)||window.customCards.push({type:Ie,name:"Nabu Eyes Dashboard",description:"Animated Assist avatar with media and alarm indicators.",preview:!0})}export{qe as NabuEyesDashboardCard};
//# sourceMappingURL=nabu-eyes-dashboard-card.js.map
